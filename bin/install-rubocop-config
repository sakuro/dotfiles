#!/bin/zsh

set -eu

zparseopts -D -E -A opts d:

config_root=".rubocop.d"
(( ${+opts[-d]} )) && config_root="${opts[-d]}"

bundle add rubocop "rubocop-${(o)^@}" --group development

git submodule add https://github.com/sakuro/rubocop-config "${config_root}"
bundle exec rake -f "${config_root}/Rakefile" .rubocop.yml
touch .rubocop_todo.yml
bundle exec rubocop --auto-gen-config --no-exclude-limit --no-offense-counts --no-auto-gen-timestamp

[[ -f Rakefile ]] && bundle exec rake -f "${config_root}/Rakefile" "rake_task[Rakefile]"

git add .
git commit -m "Generate RuboCop configuration"
