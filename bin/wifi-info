#!/bin/zsh

iface=$(networksetup -listallhardwareports | sed -n -e '/Wi-Fi/{n;s/Device: //;p;q}')
ssid=$(ipconfig getsummary en0 | grep -Po '(?<=\bSSID\b : ).*')

rssi=$(
  osascript -l JavaScript \
    -e 'ObjC.import("CoreWLAN")' \
    -e 'const wifi = $.CWWiFiClient.sharedWiFiClient.performSelector("interface")' \
    -e 'wifi ? wifi.rssiValue : ""'
)

jq -n --arg ssid "$ssid" --arg rssi "$rssi" '{ssid: $ssid, rssi: ($rssi | tonumber)}'
