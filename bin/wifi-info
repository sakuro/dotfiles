#!/bin/zsh

ssid=$(system_profiler SPAirPortDataType | sed -n '/Current Network Information/{n;s/://;s/^ *//;p;q}')

rssi=$(
  osascript -l JavaScript \
    -e 'ObjC.import("CoreWLAN")' \
    -e 'const wifi = $.CWWiFiClient.sharedWiFiClient.performSelector("interface")' \
    -e 'wifi ? wifi.rssiValue : ""'
)

jq -n --arg ssid "$ssid" --arg rssi "$rssi" '{ssid: $ssid, rssi: ($rssi | tonumber)}'
