#!/bin/zsh

PATH="$XDG_CONFIG_HOME/tmux/widgets:$PATH"

if [[ -r /proc/loadavg ]]; then
  set -- $(< /proc/loadavg)
  ncpu=$(< /proc/cpuinfo | grep '^processor' |wc -l)
elif [[ -x /usr/sbin/sysctl ]]; then
  set -- $(/usr/sbin/sysctl -n vm.loadavg)
  shift
  ncpu=$(/usr/sbin/sysctl -n hw.ncpu)
else
  return
fi

local -i load_average=$(( $1 / $ncpu )) # round down fraction
print -nP "\U1F4C8"
case "$load_average" in
0|1|2) tmux-levels magenta white $load_average ;;
3|4|5|6|7) tmux-levels red white $load_average ;;
*) tmux-levels red white 8 ;;
esac
